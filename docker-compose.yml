version: "3.9"

services:
  n8n:
    image: n8nio/n8n:latest
    container_name: n8n
    env_file:
      - ./.env
    volumes:
      - ./data/n8n:/home/node/.n8n
    restart: always
    networks:
      - traefik_proxy

  postgres:
    image: postgres:13
    container_name: postgres
    environment:
      POSTGRES_DB: sortbook_db
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - traefik_proxy

  flowise:
    image: flowiseai/flowise:latest
    container_name: flowise
    environment:
      # IMPORTANT: Change FLOWISE_SECRET_KEY to a strong random value!
      FLOWISE_SECRET_KEY: "your_strong_flowise_secret_key"
      # Change FLOWISE_USERNAME and FLOWISE_PASSWORD for production!
      FLOWISE_USERNAME: "admin"
      FLOWISE_PASSWORD: "password"
      PORT: 3000
    volumes:
      - ./data/flowise:/app/data
    ports:
      - "3000:3000"
    restart: unless-stopped
    networks:
      - traefik_proxy
    labels:
      - traefik.enable=true
      - traefik.http.routers.flowise.rule=Host(`flowise.antares.local`)
      - traefik.http.routers.flowise.entrypoints=websecure
      - traefik.http.routers.flowise.tls.certresolver=myresolver
      - traefik.http.services.flowise.loadbalancer.server.port=3000

networks:
  traefik_proxy:
    external: true
    name: docker-toolkit_default
